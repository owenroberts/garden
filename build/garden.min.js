class Charon extends Sprite{constructor(t,s,i,e){super(t,s),this.speed=[3,0],this.mapPosition=[t,s],this.addAnimation(i,(()=>{this.animation.play()})),this.center=!0,this.hasSFX=!1}addSFX(t){this.sfx=[],t.forEach((t=>{"paddle"===t.currentSrc.split("/").pop().split("-").shift()&&this.sfx.push(t)})),this.sfxCount=0,this.sfxInterval=64,this.hasSFX=!0}checkBounds(t,s){this.mapPosition[0]>=t.right+this.width&&(this.mapPosition[0]=t.left-this.width-s-s)}update(t,s){this.mapPosition[0]+=s*this.speed[0],this.position[0]=this.mapPosition[0]+t[0],this.position[1]=this.mapPosition[1]+t[1],this.isOnScreen()&&this.hasSFX&&this.playSFX()}playSFX(){if(0===this.sfxCount){let t=Math.floor(Math.random()*this.sfx.length);this.sfx[t].play(),this.sfxCount++}else this.sfxCount===this.sfxInterval?this.sfxCount=0:this.sfxCount++}}class Pilgrim extends Sprite{constructor(t,s,i,e){super(s,i),this.mapPosition=[Math.round(s),Math.round(i)],this.center=!0,this.debug=e||!1,this.speed=[6,6],this.addAnimation(t),this.animation.state="idle",this.input={right:!1,up:!1,left:!1,down:!1},this.inBounds=[!0,!0],this.hasSFX=!1}addSFX(t){this.sfx={},t.forEach((t=>{const s=t.currentSrc.split("/").pop().split("-").shift();this.sfx[s]||(this.sfx[s]=[]),this.sfx[s].push(t)})),this.sfxType="water",this.sfxCount=0,this.sfxInterval=18,this.hasSFX=!0}inputKey(t,s){this.input[t]=s}checkBounds(t,s,i){this.inBounds=[!0,!0],this.mapPosition[1]<=t.top&&this.position[1]<=s&&(this.inBounds[1]=!1,this.position[1]<-s&&(this.position[1]=3*s,this.mapPosition[1]=t.bottom)),this.mapPosition[1]>=t.bottom&&this.position[1]>=s&&(this.inBounds[1]=!1,this.position[1]>3*s&&(this.position[1]=-s,this.mapPosition[1]=t.top)),this.inBounds[1]&&this.position[1]!==s&&(this.position[1]=s),this.mapPosition[0]<=t.left&&this.position[0]<=i&&(this.inBounds[0]=!1,this.position[0]<-i&&(this.position[0]=3*i,this.mapPosition[0]=t.right)),this.mapPosition[0]>=t.right&&this.position[0]>=i&&(this.inBounds[0]=!1,this.position[0]>3*i&&(this.position[0]=-i,this.mapPosition[0]=t.left)),this.inBounds[0]&&this.position[0]!==i&&(this.position[0]=i)}update(t){let s=this.animation.stateName.includes("idle")?this.animation.state:Cool.random(["idle","idle_2","idle_3","idle_1"]);const i=[0,0];this.input.up&&(i[1]=-this.speed[1],(this.input.left||this.input.right)&&(i[1]*=.71),s=this.input.left?"up-left":this.input.right?"up-right":"up"),this.input.down&&(i[1]=this.speed[1],(this.input.left||this.input.right)&&(i[1]*=.71),s=this.input.left?"down-left":this.input.right?"down-right":"down"),this.input.left&&(i[0]=-this.speed[0],(this.input.up||this.input.down)&&(i[0]*=.71),this.input.up||this.input.down||(s="left")),this.input.right&&(i[0]=this.speed[0],(this.input.up||this.input.down)&&(i[0]*=.71),this.input.up||this.input.down||(s="right")),this.inBounds[0]?this.mapPosition[0]+=Math.floor(i[0]*t):this.position[0]+=Math.floor(i[0]*t),this.inBounds[1]?this.mapPosition[1]+=Math.floor(i[1]*t):this.position[1]+=Math.floor(i[1]*t),this.animation.state=s,this.hasSFX&&this.playSFX(i)}playSFX(t){this.mapPosition[1]>412&&this.mapPosition[1]<800?this.sfxType="water":this.mapPosition[1]<-2673?this.sfxType="wind":this.mapPosition[0]>-4245&&this.mapPosition[0]<-2700&&this.mapPosition[1]>4939&&this.mapPosition[1]<6079?this.sfxType="ice":this.mapPosition[0]<326&&this.mapPosition[1]<412?this.sfxType="forest":this.mapPosition[0]<326?this.sfxType="mud":this.mapPosition[0]>326&&this.mapPosition[1]<-1240?this.sfxType="sand":this.mapPosition[0]>326&&this.mapPosition[1]<412||this.mapPosition[0]>326&&this.mapPosition[1]<5e3?this.sfxType="grass":this.mapPosition[0]>326&&this.mapPosition[1]>5e3?this.sfxType="road":this.sfxType="grass";let s=Math.abs(t[0])+Math.abs(t[1]);if(s>0&&0===this.sfxCount){let t=Math.floor(Math.random()*this.sfx[this.sfxType].length);this.sfx[this.sfxType][t].play(),this.sfxCount++}else 0===s||this.sfxCount===this.sfxInterval?this.sfxCount=0:this.sfxCount++}}const title=document.getElementById("title");function loadingAnimation(){let t="~"+title.textContent+"~";title.textContent=t}let loadingInterval=setInterval(loadingAnimation,1e3/12);const isMobile=Cool.mobilecheck();isMobile&&document.body.classList.add("mobile");const gme=new Game({dps:24,zoom:isMobile?1:1.5,width:window.innerWidth,height:window.innerHeight,multiColor:!0,checkRetina:!0,suspend:!0,testPerformance:!0,events:isMobile?["touch"]:["keyboard","mouse"],scenes:["game","splash","loading"],bounds:{left:-5e3,top:-4e3,right:5e3,bottom:1e4},relativeLoadPath:!0});gme.load({scenery:"data/scenery.json",textures:"data/textures.json",sprites:"data/sprites.json",ui:"data/ui.json"},!1);let pilgrim,charon,halfHeight,halfWidth,doodoo,sfx=[],userStarted=!1;function loadSound(){const{Doodoo:t}=doodooLib;gme.scenes.current="loading";const s=["foot_steps/forest-1.mp3","foot_steps/forest-2.mp3","foot_steps/forest-3.mp3","foot_steps/forest-4.mp3","foot_steps/forest-5.mp3","foot_steps/forest-6.mp3","foot_steps/grass-0.mp3","foot_steps/grass-1.mp3","foot_steps/grass-5.mp3","foot_steps/grass-6.mp3","foot_steps/grass-7.mp3","foot_steps/grass-8.mp3","foot_steps/grass-9.mp3","foot_steps/ice-1.mp3","foot_steps/ice-2.mp3","foot_steps/ice-3.mp3","foot_steps/ice-4.mp3","foot_steps/ice-5.mp3","foot_steps/mud-1.mp3","foot_steps/mud-2.mp3","foot_steps/mud-3.mp3","foot_steps/mud-4.mp3","foot_steps/mud-5.mp3","foot_steps/mud-6.mp3","foot_steps/mud-7.mp3","foot_steps/road-1.mp3","foot_steps/road-2.mp3","foot_steps/road-3.mp3","foot_steps/road-4.mp3","foot_steps/road-5.mp3","foot_steps/sand-1.mp3","foot_steps/sand-2.mp3","foot_steps/sand-3.mp3","foot_steps/sand-4.mp3","foot_steps/sand-5.mp3","foot_steps/water-1.mp3","foot_steps/water-2.mp3","foot_steps/water-3.mp3","foot_steps/water-4.mp3","foot_steps/water-5.mp3","foot_steps/wind-1.mp3","foot_steps/wind-2.mp3","foot_steps/wind-3.mp3","foot_steps/wind-4.mp3","foot_steps/wind-5.mp3","foot_steps/wind-6.mp3","paddles/paddle-1.mp3","paddles/paddle-2.mp3","paddles/paddle-3.mp3","paddles/paddle-4.mp3","paddles/paddle-5.mp3"];let i=0;function e(){i++}for(let t=0;t<s.length;t++)o=`./sfx/${s[t]}`,n=void 0,(n=new Audio).addEventListener("canplaythrough",e,!1),n.src=o,n.load(),sfx.push(n);var o,n;let a=!1;doodoo=new t({tonic:"C4",parts:["C4",null,"E3","F3","G3",null,"D3","E3","D3","F3","E3","D3","F3","E3","D3","F3"],samples:"./samples/choir/"},(function(){a=!0})),doodoo.setBPM(112);const p=setInterval((()=>{i===s.length&&a&&(clearInterval(p),userStart())}),1e3/30)}function userStart(){userStarted=!0,sfx.length&&(pilgrim.addSFX(sfx),charon.addSFX(sfx)),gme.scenes.current="game"}var startX,startY,startTime;gme.start=function(){halfHeight=Math.round(gme.view.height/2),halfWidth=Math.round(gme.view.width/2),document.getElementById("splash").remove(),clearInterval(loadingInterval);let t=new UI({x:.5,y:isMobile?128:.25,animation:gme.anims.ui.title});gme.scenes.splash.addToDisplay(t);let s=new UI({x:.5,y:.5,animation:gme.anims.ui.loading});gme.scenes.loading.addToDisplay(s);let i=new UI({x:.5,y:isMobile?128:.25,animation:gme.anims.ui.desktopInstructions});i.isActive=!1,gme.scenes.splash.addToDisplay(i);let e=new UI({x:.5,y:isMobile?128:.25,animation:gme.anims.ui.mobileInstructions});e.isActive=!1,gme.scenes.splash.addToDisplay(e),gme.scenes.splash.addUI(new UI({x:isMobile?.5:.3,y:isMobile?-320:.6,isButton:!0,animation:gme.anims.ui.wSound,onClick:loadSound})),gme.scenes.splash.addUI(new UI({x:isMobile?.5:.7,y:isMobile?-192:.6,animation:gme.anims.ui.woutSound,isButton:!0,onClick:userStart}));let o=!1;gme.scenes.splash.addUI(new UI({x:.5,y:isMobile?-64:.9,animation:gme.anims.ui.what,isButton:!0,onClick:()=>{o?(t.isActive=!0,isMobile?e.isActive=!1:i.isActive=!1):(t.isActive=!1,isMobile?e.isActive=!0:i.isActive=!0),o=!o}})),gme.scenes.current="splash",pilgrim=new Pilgrim(gme.anims.sprites.pilgrim,gme.view.halfWidth,gme.view.halfHeight),charon=new Charon(-halfWidth,300,gme.anims.sprites.charon),gme.bounds.top+=Math.round(gme.halfHeight+pilgrim.height/2),gme.bounds.left+=Math.round(gme.halfWidth+pilgrim.width),gme.scenes.game=new SHGScene(gme.bounds,gme.width,gme.height);for(const t in gme.data.scenery.entries){const s=gme.data.scenery.entries[t],i=new Entity({x:s.x,y:s.y,animation:gme.anims.scenery[t],play:!0});gme.scenes.game.addSprite(i)}for(const t in gme.data.textures.entries){const s=gme.data.textures.entries[t];for(let i=0;i<s.locations.length;i++)i<=gme.anims.textures[t].endFrame&&gme.scenes.game.addSprite(new TextureEntity({x:s.locations[i].x,y:s.locations[i].y,animation:gme.anims.textures[t],stateIndex:i}))}},gme.update=function(t){pilgrim.checkBounds(gme.bounds,halfHeight,halfWidth),pilgrim.update(t/gme.dps);const s=[gme.view.width-pilgrim.mapPosition[0],gme.view.height-pilgrim.mapPosition[1]];gme.scenes.current.update(s,[pilgrim.mapPosition[0]-pilgrim.width/2,pilgrim.mapPosition[1]-pilgrim.height/2]),charon.checkBounds(gme.bounds,halfWidth),"game"===gme.scenes.currentName&&charon.update(s,t/gme.dps)},gme.draw=function(){gme.scenes.current.display(),"game"===gme.scenes.currentName&&(charon.display(),pilgrim.display())},gme.keyDown=function(t){switch(t){case"a":case"left":pilgrim.inputKey("left",!0);break;case"w":case"up":pilgrim.inputKey("up",!0);break;case"d":case"right":pilgrim.inputKey("right",!0);break;case"s":case"down":pilgrim.inputKey("down",!0);break;case"g":userStarted||userStart();break;case"h":userStarted||loadSound()}},gme.keyUp=function(t){switch(t){case"a":case"left":pilgrim.inputKey("left",!1);break;case"w":case"up":pilgrim.inputKey("up",!1);break;case"d":case"right":pilgrim.inputKey("right",!1);break;case"s":case"down":pilgrim.inputKey("down",!1)}},gme.mouseMoved=function(t,s){"splash"===gme.scenes.currentName&&gme.scenes.current.mouseMoved(t,s)},gme.mouseDown=function(t,s,i){"splash"===gme.scenes.currentName&&gme.scenes.current.mouseDown(t,s),3===i&&blurHandler()},gme.mouseUp=function(t,s){"splash"===gme.scenes.currentName&&gme.scenes.current.mouseUp(t,s)};const swipeTime=200,threshold=30,restraint=100;function blurHandler(){for(const t in pilgrim.input)pilgrim.input[t]=!1}gme.touchStart=function(t){const s=t.changedTouches[0];startX=s.pageX,startY=s.pageY,"splash"!==gme.scenes.currentName?startTime=performance.now():gme.scenes.current.mouseDown(startX,startY)},gme.touchMove=function(t){const s=t.changedTouches[0],i=startX-s.pageX,e=startY-s.pageY;Math.abs(i)>30?i<0?(pilgrim.inputKey("right",!0),pilgrim.inputKey("left",!1)):(pilgrim.inputKey("left",!0),pilgrim.inputKey("right",!1)):(pilgrim.inputKey("left",!1),pilgrim.inputKey("right",!1)),Math.abs(e)>30?e<0?(pilgrim.inputKey("down",!0),pilgrim.inputKey("up",!1)):(pilgrim.inputKey("up",!0),pilgrim.inputKey("down",!1)):(pilgrim.inputKey("down",!1),pilgrim.inputKey("up",!1))},gme.touchEnd=function(t){"splash"!==gme.scenes.currentName?(pilgrim.inputKey("left",!1),pilgrim.inputKey("up",!1),pilgrim.inputKey("right",!1),pilgrim.inputKey("down",!1)):gme.scenes.current.mouseUp(startX,startY)},gme.sizeCanvas=function(){},window.addEventListener("blur",blurHandler),document.addEventListener("visibilitychange",(t=>{"visible"===document.visibilityState?doodoo&&doodoo.play():doodoo&&doodoo.stop()}));
//# sourceMappingURL=src_maps/garden.min.js.map
